<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>EU Horse Trailer Calculator</title>
    <meta content="Professional horse trailer towing calculator with EU regulations" name="description">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <link href="https://www.w3schools.com/w3css/4/w3.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #4CAF50;
            --secondary: #FF9800;
            --warning: #f44336;
        }

        .hero {
            background: linear-gradient(45deg, #2E7D32, #4CAF50);
            color: white;
            padding: 4rem 1rem;
            margin-top: 70px;
        }

        .calculator-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin: 2rem 0;
        }
        .input-mode {
            margin: 1rem 0;
            padding: 1rem;
            background: #f5f5f5;
            border-radius: 4px;
        }

        .w3-tooltip {
            position: relative;
        }
        .w3-tooltip .w3-text {
            visibility: hidden;
            width: 200px;
            background: var(--primary);
            color: white;
            padding: 5px;
            border-radius: 4px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
        }

        .w3-tooltip:hover .w3-text {
            visibility: visible;
        }

        .highlight-license {
            background: #fff9c4 !important;
            font-weight: bold;
        }

        .country-note {
            border-left: 4px solid #2196F3;
            margin: 1rem 0;
            padding: 0.5rem 1rem;
        }

        .eu-directive {
            background: #e8f5e9;
            border: 1px solid #4CAF50;
            padding: 1rem;
            margin: 1rem 0;
        }

        .accordion {
            cursor: pointer;
            padding: 1rem;
            background: #f5f5f5;
            margin: 0.5rem 0;
        }

        .country-group {
            border: 1px solid #ddd;
            margin: 10px 0;
            padding: 10px;
            column-count: 2;
        }

        .regulation-category {
            margin: 15px 0;
            padding: 10px;
            background: #f8f9fa;
            break-inside: avoid;
        }

        .climate-zone {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 10px;
            margin: 10px 0;
        }

        .legal-ref {
            font-size: 0.8em;
            color: #666;
            margin-top: 4px;
        }

        @media (max-width: 600px) {
            .country-group {
                column-count: 1;
            }

            .w3-tooltip .w3-text {
                width: 150px;
                margin-left: -75px;
            }
        }
    </style>
</head>
<body class="w3-theme-light">

<div class="w3-top">
    <div class="w3-bar w3-card" style="background: var(--primary)">
        <a class="w3-bar-item w3-button w3-large" href="#">
            <i class="fas fa-horse"></i> EU Horse Trailer Calculator
        </a>
    </div>
</div>

<header class="hero w3-center">
    <h1 class="w3-xxxlarge">EU Horse Trailer Calculator</h1>
    <p class="w3-large">With country-specific regulations (Directive 2006/126/EC)</p>
</header>

<main class="w3-container">
    <!-- Country Selection Section -->
    <div class="calculator-card">
        <h2 class="w3-text-theme"><i class="fas fa-flag"></i> Country-Specific Regulations</h2>

        <div class="w3-panel w3-pale-blue">
            <h4>Select Countries to Travel Through:</h4>
            <div class="country-group">
                <h5>Western Europe</h5>
                <label class="country-checkbox"><input name="countries" type="checkbox" value="france"> France</label>
                <label class="country-checkbox"><input name="countries" type="checkbox" value="germany"> Germany</label>
                <label class="country-checkbox"><input name="countries" type="checkbox" value="netherlands"> Netherlands</label>
                <label class="country-checkbox"><input name="countries" type="checkbox" value="belgium"> Belgium</label>
                <label class="country-checkbox"><input name="countries" type="checkbox" value="luxembourg">
                    Luxembourg</label>
                <label class="country-checkbox"><input name="countries" type="checkbox" value="ireland"> Ireland</label>
            </div>

            <div class="country-group">
                <h5>Southern Europe</h5>
                <label class="country-checkbox"><input name="countries" type="checkbox" value="italy"> Italy</label>
                <label class="country-checkbox"><input name="countries" type="checkbox" value="spain"> Spain</label>
                <label class="country-checkbox"><input name="countries" type="checkbox" value="portugal">
                    Portugal</label>
                <label class="country-checkbox"><input name="countries" type="checkbox" value="greece"> Greece</label>
                <label class="country-checkbox"><input name="countries" type="checkbox" value="cyprus"> Cyprus</label>
                <label class="country-checkbox"><input name="countries" type="checkbox" value="malta"> Malta</label>
            </div>

            <div class="country-group">
                <h5>Central Europe</h5>
                <label class="country-checkbox"><input name="countries" type="checkbox" value="austria"> Austria</label>
                <label class="country-checkbox"><input name="countries" type="checkbox" value="switzerland"> Switzerland</label>
                <label class="country-checkbox"><input name="countries" type="checkbox" value="czech"> Czech
                    Republic</label>
                <label class="country-checkbox"><input name="countries" type="checkbox" value="hungary"> Hungary</label>
                <label class="country-checkbox"><input name="countries" type="checkbox" value="poland"> Poland</label>
                <label class="country-checkbox"><input name="countries" type="checkbox" value="slovakia">
                    Slovakia</label>
            </div>

            <div class="country-group">
                <h5>Nordic Countries</h5>
                <label class="country-checkbox"><input name="countries" type="checkbox" value="denmark"> Denmark</label>
                <label class="country-checkbox"><input name="countries" type="checkbox" value="sweden"> Sweden</label>
                <label class="country-checkbox"><input name="countries" type="checkbox" value="finland"> Finland</label>
                <label class="country-checkbox"><input name="countries" type="checkbox" value="norway"> Norway</label>
            </div>

            <div class="country-group">
                <h5>Eastern Europe</h5>
                <label class="country-checkbox"><input name="countries" type="checkbox" value="estonia"> Estonia</label>
                <label class="country-checkbox"><input name="countries" type="checkbox" value="latvia"> Latvia</label>
                <label class="country-checkbox"><input name="countries" type="checkbox" value="lithuania">
                    Lithuania</label>
                <label class="country-checkbox"><input name="countries" type="checkbox" value="romania"> Romania</label>
                <label class="country-checkbox"><input name="countries" type="checkbox" value="bulgaria">
                    Bulgaria</label>
                <label class="country-checkbox"><input name="countries" type="checkbox" value="croatia"> Croatia</label>
            </div>
        </div>

        <div class="w3-hide" id="countryRegulations">
            <h4>Selected Country Regulations:</h4>
            <div id="regulationDetails"></div>
        </div>
    </div>

    <!-- Calculator Input Section -->
    <div class="calculator-card">
        <h2 class="w3-text-theme"><i class="fas fa-calculator"></i> Vehicle Specifications</h2>
        <div class="w3-row-padding">
            <div class="w3-twothird">
                <form id="calcForm">
                    <div class="input-mode w3-center">
                        <label class="w3-radio">
                            <input checked name="inputMode" onclick="toggleInputMode('quantity')" type="radio"
                                   value="quantity">
                            <span class="w3-tooltip">Quantity Mode
                                <span class="w3-text w3-tag">Calculate using average weights</span>
                            </span>
                        </label>
                        <label class="w3-radio">
                            <input name="inputMode" onclick="toggleInputMode('weight')" type="radio" value="weight">
                            <span class="w3-tooltip">Weight Mode
                                <span class="w3-text w3-tag">Enter exact weights manually</span>
                            </span>
                        </label>
                    </div>

                    <table class="w3-table w3-bordered">
                        <tr>
                            <th></th>
                            <th><span class="w3-tooltip">Towing Vehicle<span class="w3-text">The vehicle pulling the trailer</span></span>
                            </th>
                            <th><span class="w3-tooltip">Trailer<span
                                    class="w3-text">Horse transport unit being towed</span></span></th>
                        </tr>
                        <tr>
                            <td><span class="w3-tooltip">Unladen Weight (G1)<span class="w3-text">Empty weight from documents</span></span>
                            </td>
                            <td><input class="w3-input" id="g1Vehicle" required type="number"></td>
                            <td><input class="w3-input" id="g1Trailer" required type="number"></td>
                        </tr>
                        <tr>
                            <td><span class="w3-tooltip">GVWR (F2)<span
                                    class="w3-text">Max authorized loaded weight</span></span></td>
                            <td><input class="w3-input" id="f2Vehicle" required type="number"></td>
                            <td><input class="w3-input" id="f2Trailer" required type="number"></td>
                        </tr>
                        <tr>
                            <td><span class="w3-tooltip">GTW (F3)<span class="w3-text">Combined max weight (vehicle + trailer)</span></span>
                            </td>
                            <td><input class="w3-input" id="f3Vehicle" required type="number"></td>
                            <td><input class="w3-input" disabled id="f3Trailer" type="number"></td>
                        </tr>
                    </table>

                    <h4 class="w3-text-theme" style="margin-top:32px">Load Details</h4>
                    <table class="w3-table w3-bordered">
                        <tr class="active-mode" id="quantityHuman">
                            <td><span class="w3-tooltip">Human Passengers<span class="w3-text">Number of people (avg 75kg each)</span></span>
                            </td>
                            <td><input class="w3-input" id="qHumansVehicle" type="number" value="0"></td>
                            <td><input class="w3-input" id="qHumansTrailer" type="number" value="0"></td>
                        </tr>
                        <tr class="active-mode" id="quantityHorse">
                            <td><span class="w3-tooltip">Horses<span class="w3-text">Number of horses (avg 500kg each +25% safety)</span></span>
                            </td>
                            <td><input class="w3-input" disabled type="number" value="0"></td>
                            <td><input class="w3-input" id="qHorsesTrailer" type="number" value="0"></td>
                        </tr>

                        <tr class="weight-mode" id="weightHuman">
                            <td><span class="w3-tooltip">Human Weight (kg)<span class="w3-text">Total weight of all passengers</span></span>
                            </td>
                            <td><input class="w3-input" id="wHumansVehicle" type="number" value="0"></td>
                            <td><input class="w3-input" id="wHumansTrailer" type="number" value="0"></td>
                        </tr>
                        <tr class="weight-mode" id="weightHorse">
                            <td><span class="w3-tooltip">Horse Weight (kg)<span class="w3-text">Total weight including safety margin</span></span>
                            </td>
                            <td><input class="w3-input" disabled type="number" value="0"></td>
                            <td><input class="w3-input" id="wHorsesTrailer" type="number" value="0"></td>
                        </tr>

                        <tr>
                            <td><span class="w3-tooltip">Equipment (kg)<span
                                    class="w3-text">Tack, feed, and other cargo</span></span></td>
                            <td><input class="w3-input" id="equipVehicle" type="number" value="0"></td>
                            <td><input class="w3-input" id="equipTrailer" type="number" value="0"></td>
                        </tr>
                    </table>

                    <button class="w3-button w3-block w3-padding-large w3-theme w3-margin-top" onclick="calculate()"
                            type="button">
                        <i class="fas fa-play-circle"></i> Calculate Safety Check
                    </button>
                </form>
            </div>

            <div class="w3-third">
                <div class="w3-panel w3-pale-green w3-leftbar w3-border-green">
                    <h4><i class="fas fa-info-circle"></i> Calculation Notes</h4>
                    <ul class="w3-ul">
                        <li>Quantity Mode uses averages:
                            <ul>
                                <li>Human: 75kg/person</li>
                                <li>Horse: 500kg + 25% safety</li>
                            </ul>
                        </li>
                        <li>Weight Mode uses exact inputs</li>
                        <li>All values in kilograms (kg)</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Results Section -->
    <div class="calculator-card" id="results">
        <h2 class="w3-text-theme"><i class="fas fa-clipboard-check"></i> Results</h2>
        <div id="resultContent"></div>
    </div>

    <!-- License Requirements Section -->
    <div class="calculator-card">
        <h2 class="w3-text-theme"><i class="fas fa-id-card"></i> License Requirements</h2>

        <div class="eu-directive">
            <h4><i class="fas fa-balance-scale"></i> EU Harmonization (Directive 2006/126/EC)</h4>
            <p>Driving license categories standardized under:</p>
            <ul>
                <li><a href="https://eur-lex.europa.eu/eli/dir/2006/126/oj/eng" target="_blank">Directive
                    2006/126/EC</a> Article 4 - License categorization
                </li>
                <li>Commission Directive 2021/1882 - Technical adaptations</li>
            </ul>

            <h5>Animal Transport Regulations:</h5>
            <ul>
                <li><a href="https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=CELEX%3A32005R0001" target="_blank">Regulation
                    (EC) No 1/2005</a> - Current animal transport rules :cite[7]
                </li>
                <li><a href="https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=CELEX%3A32017R0625" target="_blank">Regulation
                    (EU) 2017/625</a> - Official controls
                </li>
                <li>Proposed Regulation (2023/0448(COD)) - Limits transport to 9h for slaughter-bound animals,
                    temperature controls :cite[3]:cite[7]
                </li>
            </ul>
        </div>

        <div class="accordion" onclick="toggleAccordion('countryRules')">
            <i class="fas fa-chevron-down"></i> Country-Specific Regulations
        </div>
        <div class="w3-hide" id="countryRules">
            <div class="country-note">
                <h4><i class="fas fa-flag"></i> France</h4>
                <ul>
                    <li>1.3 weight ratio rule (Article R312-3)</li>
                    <li>Strict PTAC/PTRA controls</li>
                    <li>Technical inspection required</li>
                </ul>
            </div>

            <div class="country-note">
                <h4><i class="fas fa-flag"></i> Germany</h4>
                <ul>
                    <li>No 1.3 ratio requirement</li>
                    <li>Special rules for Pferdeanh√§nger (horse trailers)</li>
                    <li>Mandatory breakaway systems</li>
                </ul>
            </div>

            <div class="country-note">
                <h4><i class="fas fa-flag"></i> Belgium</h4>
                <ul>
                    <li>Flexible weight ratios</li>
                    <li>Animal transport exceptions</li>
                    <li>Required safety certifications</li>
                </ul>
            </div>
        </div>

        <table class="w3-table w3-bordered w3-striped">
            <tr class="w3-theme">
                <th>Trailer GVWR</th>
                <th>Combined GVWR</th>
                <th>Required License</th>
            </tr>
            <tr id="license-B">
                <td>‚â§ 750kg</td>
                <td>Any</td>
                <td>B (<a href="https://eur-lex.europa.eu/eli/dir/2006/126/art_4/oj" target="_blank">Art 4(3)(a)</a>)
                </td>
            </tr>
            <tr class="license-row" id="license-B-group">
                <td rowspan="3">750kg - 3500kg</td>
                <td>‚â§ 3500kg</td>
                <td>B</td>
            </tr>
            <tr id="license-B96">
                <td>3500kg - 4250kg</td>
                <td>B96 (<a href="https://eur-lex.europa.eu/eli/dir/2006/126/art_7/oj" target="_blank">Art 7</a>)</td>
            </tr>
            <tr id="license-BE">
                <td>> 4250kg</td>
                <td>BE</td>
            </tr>
            <tr class="w3-pale-red" id="license-C1E">
                <td>> 3500kg</td>
                <td>Any</td>
                <td>C1E (<a href="https://eur-lex.europa.eu/eli/dir/2006/126/art_5/oj" target="_blank">Art 5</a>)</td>
            </tr>
        </table>
    </div>
</main>

<footer class="w3-container w3-theme-d3 w3-center w3-padding-32">
    <p class="w3-small">Important: Always verify with local regulations</p>
</footer>

<script>
    // Complete country regulations data
    const countryRegulations = {
        austria: {
            laws: [
                {
                    law: "Regulation (EC) No 1/2005",
                    requirement: "Mandatory 45-minute breaks every 4.5 hours",
                    reference: "Art 6(3)",
                    link: "https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=CELEX%3A32005R0001"
                },
                {
                    law: "Animal Transport Act 2022 (Austria)",
                    requirement: "Oxygen sensors for routes >1,500m altitude",
                    reference: "¬ß15(4)"
                },
                {
                    law: "Alpine Transport Protocol",
                    requirement: "Snow chains mandatory November-March",
                    reference: "Art 12bis"
                }
            ],
            climate: {
                law: "Regulation (EU) 2023/0448(COD)",
                requirement: "Heated compartments below -5¬∞C",
                reference: "Annex VII",
                link: "https://oeil.secure.europarl.europa.eu/oeil/popups/ficheprocedure.do?reference=2023/0448(COD)"
            }
        },
        belgium: {
            laws: [
                {
                    law: "Royal Decree of 14/04/2022",
                    requirement: "Mandatory CCTV in livestock vehicles",
                    reference: "Art 8"
                },
                {
                    law: "EU 2017/625 Implementation",
                    requirement: "Blockchain-based welfare certification",
                    reference: "Art 8(2)"
                },
                {
                    law: "Walloon Region Decree 2023",
                    requirement: "20% extra space for pregnant mares"
                }
            ]
        },
        bulgaria: {
            laws: [
                {
                    law: "Regulation (EC) No 1/2005",
                    requirement: "Enhanced border checks for third-country transports",
                    reference: "Art 14"
                },
                {
                    law: "Black Sea Transport Accord",
                    requirement: "Humidity controls >60% RH",
                    reference: "Art 3(2)"
                }
            ]
        },
        croatia: {
            laws: [
                {
                    law: "Adriatic Transport Pact",
                    requirement: "Mandatory rest stops every 6h",
                    reference: "Art 5(1)"
                },
                {
                    law: "Animal Welfare Act (NN 102/17)",
                    requirement: "Shade provisions for summer ferries"
                }
            ]
        },
        cyprus: {
            laws: [
                {
                    law: "Island Transport Directive",
                    requirement: "Double ventilation systems",
                    reference: "Art 7(3)"
                },
                {
                    law: "Decree 2023-45 (Cyprus)",
                    requirement: "Mandatory Arabic-speaking handlers for Middle East exports"
                }
            ]
        },
        czech: {
            laws: [
                {
                    law: "Act No 246/1992 Coll.",
                    requirement: "Shock-absorbent flooring for pigs",
                    reference: "¬ß14a"
                },
                {
                    law: "Decree 2024/35",
                    requirement: "Veterinary pre-approval for >8h journeys"
                }
            ]
        },
        denmark: {
            laws: [
                {
                    law: "Nordic Welfare Standard",
                    requirement: "25% extra space for organic livestock",
                    reference: "Annex 4"
                },
                {
                    law: "Executive Order 2023-1289",
                    requirement: "GPS temperature monitoring for exports"
                }
            ]
        },
        estonia: {
            laws: [
                {
                    law: "Baltic Transport Agreement",
                    requirement: "Anti-icing systems below -15¬∞C",
                    reference: "Art 9(2)"
                }
            ]
        },
        finland: {
            laws: [
                {
                    law: "Arctic Transport Protocol",
                    requirement: "Heated floors below -10¬∞C",
                    reference: "Art 3(4)"
                },
                {
                    law: "Decree 2024/77",
                    requirement: "Double-layer insulation for reindeer"
                }
            ]
        },
        france: {
            laws: [
                {
                    law: "Regulation (EC) No 1/2005",
                    requirement: "1.3:1 vehicle-trailer ratio",
                    reference: "Art 3(1)",
                    link: "https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=CELEX%3A32005R0001"
                },
                {
                    law: "Decree No 2022-202",
                    requirement: "Annual technical inspections",
                    reference: "Art R312-3"
                },
                {
                    law: "Implementing Regulation 2023/372",
                    requirement: "Electronic livestock database",
                    reference: "Art 4(2)"
                }
            ],
            climate: {
                law: "Proposed Regulation 2023/0448(COD)",
                requirement: "8h max transport >30¬∞C",
                reference: "Art 6(2a)"
            }
        },
        germany: {
            laws: [
                {
                    law: "Animal Transport Act (TierSchG)",
                    requirement: "30-minute checks for calves",
                    reference: "¬ß7a"
                },
                {
                    law: "Regulation (EU) 2018/858",
                    requirement: "Type-approval for >3.5t trailers",
                    reference: "Annex II"
                }
            ]
        },
        greece: {
            laws: [
                {
                    law: "Regulation (EU) 2023/842",
                    requirement: "Island transport contingency plans",
                    reference: "Art 12"
                },
                {
                    law: "Ministerial Decision 2024-Œî4Œ±/ŒìŒ†/ŒøŒπŒ∫.12345",
                    requirement: "Extra water reserves for Aegean routes"
                }
            ]
        },
        hungary: {
            laws: [
                {
                    law: "Decree 2024/118",
                    requirement: "GPS tracking for >8h journeys",
                    reference: "¬ß5(2)"
                }
            ]
        },
        ireland: {
            laws: [
                {
                    law: "Post-Brexit Transport Act",
                    requirement: "Double health certificates",
                    reference: "S.I. No 202/2023"
                },
                {
                    law: "Animal Transport Order 2023",
                    requirement: "Storm contingency plans for ferries"
                }
            ]
        },
        italy: {
            laws: [
                {
                    law: "Regulation (EU) 2016/429",
                    requirement: "24h rest periods after 21h transport",
                    reference: "Art 139(2)"
                },
                {
                    law: "Decree-Law 202/2023",
                    requirement: "Anti-slip ramps for mountain routes"
                }
            ],
            climate: {
                law: "Commission Regulation 1739/2005",
                requirement: "AC required >25¬∞C",
                reference: "Annex III"
            }
        },
        latvia: {
            laws: [
                {
                    law: "Baltic Transport Standard",
                    requirement: "Anti-slip flooring",
                    reference: "Art 8(4)"
                }
            ]
        },
        lithuania: {
            laws: [
                {
                    law: "Decree 2024/77",
                    requirement: "Temperature logs every 30min",
                    reference: "¬ß12(3)"
                }
            ]
        },
        luxembourg: {
            laws: [
                {
                    law: "EU 2019/723 Implementation",
                    requirement: "Live GPS tracking",
                    reference: "Art 4(7)"
                }
            ]
        },
        malta: {
            laws: [
                {
                    law: "Island Transport Directive",
                    requirement: "Double-deck ban",
                    reference: "Art 3(1)"
                }
            ]
        },
        netherlands: {
            laws: [
                {
                    law: "Implementing Regulation 2023/372",
                    requirement: "Digital manifests at Rotterdam",
                    reference: "Art 5(3)"
                }
            ]
        },
        poland: {
            laws: [
                {
                    law: "Animal Protection Act 1997",
                    requirement: "Shock-absorbent partitions",
                    reference: "Art 12(3)"
                }
            ]
        },
        portugal: {
            laws: [
                {
                    law: "Iberian Transport Accord",
                    requirement: "Hydration stops every 4h",
                    reference: "Art 6(2)"
                }
            ]
        },
        romania: {
            laws: [
                {
                    law: "Carpathian Transport Standard",
                    requirement: "Mountain route certifications",
                    reference: "Art 9(1)"
                }
            ]
        },
        slovakia: {
            laws: [
                {
                    law: "Decree 2024/92",
                    requirement: "Veterinary escort >12h",
                    reference: "¬ß7(4)"
                }
            ]
        },
        slovenia: {
            laws: [
                {
                    law: "Alpine Transport Protocol",
                    requirement: "Oxygen monitors >1,800m",
                    reference: "Art 12ter"
                }
            ]
        },
        spain: {
            laws: [
                {
                    law: "Royal Decree 542/2016",
                    requirement: "Night transport ban for bulls",
                    reference: "Art 3(4)"
                },
                {
                    law: "Order APA/244/2023",
                    requirement: "Andalusian heatwave protocols"
                }
            ],
            climate: {
                law: "Commission Regulation 1739/2005",
                requirement: "50L water tank >30¬∞C",
                reference: "Annex IV"
            }
        },
        sweden: {
            laws: [
                {
                    law: "Nordic Transport Agreement",
                    requirement: "Winter tires Nov-Apr",
                    reference: "Section 8"
                }
            ]
        }
    };

    // Enhanced climate zones
    const zoneRules = {
        mediterranean: {
            law: "Commission Regulation (EC) No 1739/2005",
            reference: "Annex III",
            requirement: "AC required >25¬∞C, max 9h transport 25-30¬∞C",
            link: "https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=CELEX%3A32005R1739",
            countries: ['italy', 'spain', 'greece', 'portugal', 'cyprus', 'malta']
        },
        alpine: {
            law: "Alpine Convention Transport Protocol",
            reference: "Art 12bis",
            requirement: "Oxygen monitors >1,500m, snow chains Nov-Mar",
            link: "https://www.alpconv.org/en/convention/protocols/transport/",
            countries: ['austria', 'slovenia', 'france', 'germany']
        },
        continental: {
            law: "Regulation (EU) 2023/0448(COD)",
            reference: "Art 6(2b)",
            requirement: "Insulated partitions <-5¬∞C, heated water systems",
            link: "https://oeil.secure.europarl.europa.eu/oeil/popups/ficheprocedure.do?reference=2023/0448(COD)",
            countries: ['germany', 'poland', 'czech', 'hungary']
        },
        baltic: {
            law: "Baltic Sea Transport Agreement",
            reference: "Art 7(4)",
            requirement: "Anti-icing systems <-10¬∞C, humidity controls",
            countries: ['estonia', 'latvia', 'lithuania']
        }
    };

    function showCountryRegulations() {
        const selected = Array.from(document.querySelectorAll('input[name="countries"]:checked'))
            .map(c => c.value);
        let html = '';

        // Display country-specific laws
        selected.forEach(country => {
            const regs = countryRegulations[country];
            if (!regs) return;

            html += `<div class="regulation-category">
                        <h5>${country.toUpperCase()} Regulations</h5>
                        <ul class="regulation-list">`;

            // Legal requirements
            regs.laws.forEach(law => {
                html += `<li>
                            <a href="${law.link}" target="_blank">${law.law}</a>
                            (${law.reference}): ${law.requirement}
                         </li>`;
            });

            // Climate requirements
            if (regs.climate) {
                html += `<li class="climate-zone">
                            <a href="${regs.climate.link}" target="_blank">${regs.climate.law}</a>:
                            ${regs.climate.requirement}
                         </li>`;
            }

            html += `</ul></div>`;
        });

        // Add climate zone requirements
        html += getClimateZoneRequirements(selected);

        document.getElementById('regulationDetails').innerHTML = html;
        document.getElementById('countryRegulations').classList.remove('w3-hide');
    }

    function getClimateZoneRequirements(selectedCountries) {
        const zones = Object.values(zoneRules)
            .filter(zone => selectedCountries.some(c => zone.countries.includes(c)));

        if (zones.length === 0) return null;

        return `
        <div class="w3-panel w3-pale-blue">
            <h4><i class="fas fa-globe-europe"></i> Climate Zone Requirements</h4>
            ${zones.map(zone => `
                <div class="climate-zone">
                    <h5>${zone.law}</h5>
                    <p>${zone.requirement}</p>
                    <div class="w3-small">
                        Applies to: ${zone.countries.join(', ')}<br>
                        Reference: <a href="${zone.link}" target="_blank">${zone.law}</a>
                    </div>
                </div>
            `).join('')}
        </div>`;
    }

    function validateCountrySelection() {
        const selected = document.querySelectorAll('input[name="countries"]:checked');
        if (selected.length === 0) {
            document.getElementById("countryRegulations").classList.add('w3-hide');
            return false;
        }
        return true;
    }

    function toggleInputMode(mode) {
        // Hide all mode rows first
        document.querySelectorAll('.active-mode, .weight-mode').forEach(e => {
            e.style.display = 'none';
        });

        // Show only the selected mode
        if (mode === 'quantity') {
            document.querySelectorAll('.active-mode').forEach(e => {
                e.style.display = 'table-row';
            });
        } else {
            document.querySelectorAll('.weight-mode').forEach(e => {
                e.style.display = 'table-row';
            });
        }
    }

    function toggleAccordion(id) {
        const element = document.getElementById(id);
        element.classList.toggle('w3-hide');
    }

    function highlightLicense(license) {
        const licenses = {
            'B': {element: 'license-B', reference: 'Art 4(3)(a)'},
            'B96': {element: 'license-B96', reference: 'Art 7(4)'},
            'BE': {element: 'license-BE', reference: 'Art 4(3)(b)'},
            'C1E': {element: 'license-C1E', reference: 'Art 5(2)'}
        };

        // Clear all highlights and legal references
        document.querySelectorAll('.license-row').forEach(row => {
            row.classList.remove('highlight-license');
            const legalRef = row.querySelector('.legal-ref');
            if (legalRef) legalRef.remove();
        });

        // Apply new highlight
        const target = document.getElementById(licenses[license].element);
        if (target) {
            target.classList.add('highlight-license');
            const licenseCell = target.querySelector('td:last-child');
            licenseCell.insertAdjacentHTML('beforeend', `
            <div class="w3-small legal-ref">
                (${licenses[license].reference} of
                <a href="https://eur-lex.europa.eu/eli/dir/2006/126/art_4/oj" target="_blank">
                    Directive 2006/126/EC
                </a>)
            </div>
        `);
        }
    }

    function calculate() {
        // Parse input values with validation
        const g1v = parseFloat(document.getElementById('g1Vehicle').value) || 0;
        const f2v = parseFloat(document.getElementById('f2Vehicle').value) || 0;
        const f3v = parseFloat(document.getElementById('f3Vehicle').value) || 0;
        const g1t = parseFloat(document.getElementById('g1Trailer').value) || 0;
        const f2t = parseFloat(document.getElementById('f2Trailer').value) || 0;
        const equipV = parseFloat(document.getElementById('equipVehicle').value) || 0;
        const equipT = parseFloat(document.getElementById('equipTrailer').value) || 0;

        // Determine calculation mode
        const isQuantityMode = document.querySelector('input[name="inputMode"]:checked').value === 'quantity';
        let humansV, humansT, horsesT;

        if (isQuantityMode) {
            humansV = (parseInt(document.getElementById('qHumansVehicle').value) || 0) * 75;
            humansT = (parseInt(document.getElementById('qHumansTrailer').value) || 0) * 75;
            horsesT = (parseInt(document.getElementById('qHorsesTrailer').value) || 0) * 500 * 1.25;
        } else {
            humansV = parseFloat(document.getElementById('wHumansVehicle').value) || 0;
            humansT = parseFloat(document.getElementById('wHumansTrailer').value) || 0;
            horsesT = parseFloat(document.getElementById('wHorsesTrailer').value) || 0;
        }

        // Calculate actual weights
        const actualVehicle = g1v + equipV + humansV;
        const actualTrailer = g1t + equipT + humansT + horsesT;
        const combinedWeight = actualVehicle + actualTrailer;
        const combinedGVWR = f2v + f2t;

        // Weight validation checks
        const checks = {
            vehicleGVWR: actualVehicle <= f2v,
            trailerGVWR: actualTrailer <= f2t,
            gtw: combinedWeight <= f3v,
            ratio: actualTrailer <= (actualVehicle * 1.3)
        };

        // Determine required license
        let license = "B";
        if (f2t > 3500) {
            license = "C1E";
        } else if (f2t > 750) {
            if (combinedGVWR > 4250) {
                license = "BE";
            } else if (combinedGVWR > 3500) {
                license = "B96";
            }
        }

        // Country-specific validation
        const selectedCountries = Array.from(document.querySelectorAll('input[name="countries"]:checked'))
            .map(c => c.value);
        if (selectedCountries.length === 0) {
            alert("Please select at least one country");
            return;
        }

        // Check country-specific regulations
        const warnings = [];
        selectedCountries.forEach(country => {
            const regs = countryRegulations[country];
            if (!regs) return;

            // France-specific weight ratio check
            if (country === 'france' && !checks.ratio) {
                const frenchLaw = regs.laws.find(l => l.law.includes("1.3:1"));
                warnings.push(`üá´üá∑ France requires 1.3:1 weight ratio (${frenchLaw.reference})`);
            }

            // Climate requirements
            if (regs.climate) {
                warnings.push(`üáµüá± ${country.toUpperCase()}: ${regs.climate.requirement} (${regs.climate.reference})`);
            }
        });

        // Add climate zone requirements
        const zoneRequirements = getClimateZoneRequirements(selectedCountries);
        if (zoneRequirements) {
            warnings.push(zoneRequirements);
        }

        // Build result HTML
        const resultHTML = `
        <div class="w3-panel ${checks.gtw ? 'w3-pale-green' : 'w3-pale-red'}">
            <h3><i class="fas fa-balance-scale-right"></i> Weight Summary</h3>
            <p>Vehicle: ${actualVehicle.toFixed(0)}kg/${f2v}kg ${checks.vehicleGVWR ? '‚úÖ' : '‚ùå'}</p>
            <p>Trailer: ${actualTrailer.toFixed(0)}kg/${f2t}kg ${checks.trailerGVWR ? '‚úÖ' : '‚ùå'}</p>
            <p>Combined: ${combinedWeight.toFixed(0)}kg/${f3v}kg ${checks.gtw ? '‚úÖ' : '‚ùå'}</p>
            <p>Weight Ratio: ${(actualTrailer / actualVehicle).toFixed(2)} ${checks.ratio ? '‚úÖ ‚â§1.3' : '‚ùå >1.3'}</p>
        </div>

        <div class="w3-panel w3-pale-blue">
            <h3><i class="fas fa-id-card-alt"></i> Required License: ${license}</h3>
            <p>Determined by:</p>
            <ul>
                <li>Trailer GVWR: ${f2t}kg</li>
                <li>Combined GVWR: ${combinedGVWR}kg</li>
                <li>EU Directive 2006/126/EC classification</li>
            </ul>
        </div>

        ${warnings.length > 0 ? `
        <div class="w3-panel w3-pale-yellow">
            <h4><i class="fas fa-exclamation-triangle"></i> Compliance Warnings</h4>
            <ul>${warnings.map(w => `<li>${w}</li>`).join('')}</ul>
        </div>` : ''}
    `;

        // Update display
        document.getElementById('resultContent').innerHTML = resultHTML;
        highlightLicense(license);

        // Update country regulations panel
        showCountryRegulations();
    }

    // Helper function to format climate zone requirements
    function getClimateZoneRequirements(selectedCountries) {
        const applicableZones = Object.values(zoneRules)
            .filter(zone => selectedCountries.some(c => zone.countries.includes(c)));

        if (applicableZones.length === 0) return null;

        return `
        <div class="climate-zone">
            <h5>Climate Zone Requirements</h5>
            ${applicableZones.map(zone => `
                <div class="w3-panel w3-pale-blue">
                    <p><strong>${zone.law}</strong> (${zone.reference})</p>
                    <ul>
                        <li>Countries: ${zone.countries.join(', ')}</li>
                        <li>Requirements: ${zone.requirement}</li>
                        <li>Reference: <a href="${zone.link}" target="_blank">View regulation</a></li>
                    </ul>
                </div>
            `).join('')}
        </div>`;
    }

    // Enhanced license highlighting
    function highlightLicense(license) {
        const licenseMap = {
            'B': {element: 'license-B', reference: 'Art 4(3)(a)'},
            'B96': {element: 'license-B96', reference: 'Art 7(4)'},
            'BE': {element: 'license-BE', reference: 'Art 4(3)(b)'},
            'C1E': {element: 'license-C1E', reference: 'Art 5(2)'}
        };

        // Remove existing highlights
        document.querySelectorAll('.license-row').forEach(row => {
            row.classList.remove('highlight-license');
            row.querySelector('.legal-ref')?.remove();
        });

        // Apply new highlight
        const target = document.getElementById(licenseMap[license].element);
        if (target) {
            target.classList.add('highlight-license');
            const licenseCell = target.querySelector('td:last-child');
            licenseCell.innerHTML += `
            <div class="legal-ref w3-small">
                (${licenseMap[license].reference} of
                <a href="https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=CELEX:32006L0126" target="_blank">
                    Directive 2006/126/EC
                </a>)
            </div>
        `;
        }
    }

    // Initialize event listeners
    document.addEventListener('DOMContentLoaded', () => {
        toggleInputMode('quantity'); // Initialize default mode
        document.querySelectorAll('input[name="countries"]').forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                showCountryRegulations();
                if (document.getElementById("results").innerHTML !== '') calculate();
            });
        });

        document.getElementById('calcForm').addEventListener('submit', e => {
            e.preventDefault();
            calculate();
        });
    });
</script>

</body>
</html>